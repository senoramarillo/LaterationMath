package latmath.test;

import org.apache.commons.math3.linear.Array2DRowRealMatrix;
import org.apache.commons.math3.linear.RealMatrix;
import java.util.Arrays;
import latmath.util.Point2d;

public class GeolaterationNTest {
	static boolean doApprox;
	static int approxMethod;
	static boolean doFilter1;
	static boolean doFilter1IncludeApprox;
	static int filter1Limit;
	static boolean doFilter2;
	static double medianFactor;
	static double weightRealIntersection;
	static double weightApproxIntersection;
	static int finalPositionAlgorithm;

	public static void main(String[] args) {

		/** Final position estimation for GEO-N: center of mass */
		final int CENTER_OF_MASS = 1;

		/** Final position estimation for GEO-N: geometric median */
		final int GEOMETRIC_MEDIAN = 2;

		/** Default Geo-n approx method */
		final int APPROX_1 = 1;

		/** Bilateration approx method */
		// final int APPROX_2 = 2;

		doApprox = true;
		approxMethod = APPROX_1;
		doFilter1 = true;
		doFilter1IncludeApprox = false;
		filter1Limit = 2;
		doFilter2 = true;
		weightRealIntersection = 3.0;
		weightApproxIntersection = 3.0;
		medianFactor = GEOMETRIC_MEDIAN;

		Point2d[] anchors = new Point2d[] { new Point2d(24.5626016260160, 2.29970731707320),
				new Point2d(23.1605118679050, 8.57622125902990), new Point2d(24.7228648090820, 12.1175545923630),
				new Point2d(26.0127689243310, 9.01743205528970), new Point2d(30.8588226401950, 9.19865358007020),
				new Point2d(30.6951496849370, 1.20326677881980), new Point2d(26.5792387026600, 1.27245974100970),
				new Point2d(24.9928307764210, 6.69500716668635), new Point2d(27.0096672540500, 6.66041068559140) };

		double[][] ranges;

		double[] distanceRanges = { 3.46000000000000, 6.94000000000000, 8.73000000000000, 6.12000000000000,
				7.54000000000000, 4.54000000000000, 2.33000000000000, 4.56000000000000, 0.120000000000000,
				3.71000000000000, 10.4800000000000, 10.3000000000000, 8, 7.80000000000000, 4.01000000000000,
				2.41000000000000, 10.5000000000000, 0.170000000000000, 3.84000000000000, 8.97000000000000,
				9.46000000000000, 5.93000000000000, 8.35000000000000, 3.84000000000000, 2.32000000000000,
				10.8200000000000, 0.150000000000000, 3.80000000000000, 8.83000000000000, 9.73000000000000,
				4.96000000000000, 8.24000000000000, 3.94000000000000, 2.32000000000000, 8.88000000000000,
				0.0300000000000000, 3.53000000000000, 11.7800000000000, 10.6000000000000, 5.94000000000000,
				7.88000000000000, 4.56000000000000, 2.07000000000000, 10.9800000000000, 0.410000000000000,
				3.66000000000000, 12.8800000000000, 10.8200000000000, 6.68000000000000, 7.41000000000000,
				4.12000000000000, 3.07000000000000, 5.21000000000000, 1.43000000000000, 16.0500000000000,
				7.07000000000000, 10.4300000000000, 5.27000000000000, 9.23000000000000, 8.67000000000000,
				3.46000000000000, 7.59000000000000, 3.44000000000000, 7.36000000000000, 6.45000000000000,
				10.8500000000000, 5.76000000000000, 5.25000000000000, 2.66000000000000, 3.37000000000000,
				9.39000000000000, 2.29000000000000, 8.64000000000000, 5.82000000000000, 13.7100000000000,
				4.31000000000000, 5.57000000000000, 4.71000000000000, 2.71000000000000, 6.27000000000000,
				3.33000000000000, 7.85000000000000, 6.76000000000000, 9.50000000000000, 4.39000000000000,
				8.31000000000000, 5.48000000000000, 3.57000000000000, 8.88000000000000, 5.50000000000000,
				5.27000000000000, 12.5800000000000, 11.8300000000000, 5.19000000000000, 7.59000000000000,
				3.34000000000000, 3.42000000000000, 6.29000000000000, 4.62000000000000, 14.9100000000000,
				11.1200000000000, 15.9500000000000, 6.09000000000000, 5.51000000000000, 4.74000000000000,
				4.35000000000000, 10.8600000000000, 1.64000000000000, 7.66000000000000, 11.8400000000000,
				10.3900000000000, 6.61000000000000, 8.10000000000000, 2.64000000000000, 2.10000000000000,
				15.1200000000000, 0.480000000000000, 9.98000000000000, 12.3500000000000, 13.4400000000000,
				11.3500000000000, 6.93000000000000, 2.71000000000000, 3.94000000000000, 9.32000000000000,
				5.71000000000000, 15.0700000000000, 8.04000000000000, 13.2200000000000, 7.60000000000000,
				6.84000000000000, 1.53000000000000, 4.47000000000000, 12.4200000000000, 0.510000000000000, 8,
				11.4600000000000, 11.6600000000000, 11.4700000000000, 11.7400000000000, 3.29000000000000,
				2.68000000000000, 9.82000000000000, 0.670000000000000, 7.74000000000000, 7.72000000000000,
				13.5400000000000, 5.65000000000000, 8.79000000000000, 3.19000000000000, 3.61000000000000,
				11.4700000000000, 0.240000000000000, 9.51000000000000, 9.39000000000000, 14.4500000000000,
				6.99000000000000, 5.65000000000000, 2.82000000000000, 3.71000000000000, 8.04000000000000,
				0.750000000000000, 5.15000000000000, 11.3400000000000, 14.9900000000000, 13.2200000000000,
				11.2000000000000, 2.22000000000000, 2.37000000000000, 6.13000000000000, 0.400000000000000,
				5.68000000000000, 11.1000000000000, 13.9000000000000, 8.10000000000000, 8.47000000000000,
				1.99000000000000, 2.02000000000000, 4.85000000000000, 2.63000000000000, 1.32000000000000,
				7.09000000000000, 10.5200000000000, 10.3900000000000, 9.43000000000000, 3.83000000000000,
				1.54000000000000, 1.70000000000000, 2.54000000000000, 1.72000000000000, 7.86000000000000,
				9.22000000000000, 6.58000000000000, 11.2100000000000, 4.37000000000000, 1.65000000000000,
				1.68000000000000, 2.74000000000000, 7.91000000000000, 11.6900000000000, 8.75000000000000,
				8.68000000000000, 5.70000000000000, 5.15000000000000, 3.73000000000000, 3.51000000000000,
				3.83000000000000, 3.10000000000000, 8.04000000000000, 10.8400000000000, 4.66000000000000,
				5.65000000000000, 4.52000000000000, 3.69000000000000, 5.21000000000000, 2, 7.32000000000000,
				5.15000000000000, 10.7500000000000, 3.46000000000000, 5.31000000000000, 5.46000000000000,
				3.50000000000000, 14.6400000000000, 2.19000000000000, 7.31000000000000, 8.99000000000000,
				15.1300000000000, 9.83000000000000, 8.80000000000000, 3.38000000000000, 4.02000000000000,
				5.57000000000000, 2.69000000000000, 9.14000000000000, 12.3300000000000, 10.8700000000000,
				8.15000000000000, 6.95000000000000, 1.31000000000000, 4.10000000000000, 7.94000000000000,
				2.41000000000000, 6.57000000000000, 9.23000000000000, 14.2100000000000, 8.28000000000000,
				7.59000000000000, 0.350000000000000, 3.89000000000000, 11.4800000000000, 2.83000000000000,
				6.09000000000000, 10.3800000000000, 14.1100000000000, 13.0800000000000, 10.3800000000000,
				0.410000000000000, 3.62000000000000, 7.57000000000000, 5.86000000000000, 8.26000000000000,
				10.8000000000000, 15.3500000000000, 8.23000000000000, 9.57000000000000, 0.490000000000000,
				3.47000000000000, 7.77000000000000, 8.69000000000000, 2.98000000000000, 7.03000000000000,
				10.5500000000000, 9, 12.1600000000000, 7, 2.77000000000000, 2.98000000000000, 1.16000000000000,
				6.12000000000000, 4.42000000000000, 9.48000000000000, 2.13000000000000, 4.69000000000000,
				5.86000000000000, 5.94000000000000, 1.55000000000000, 3.19000000000000, 4.12000000000000,
				10.4800000000000, 18.8600000000000, 5.65000000000000, 7.11000000000000, 2.82000000000000,
				2.91000000000000, 3.65000000000000, 2.13000000000000, 4.15000000000000, 5.58000000000000,
				15.8700000000000, 5.89000000000000, 7.08000000000000, 3.94000000000000, 2.69000000000000,
				4.42000000000000, 0.190000000000000, 8.74000000000000, 7.78000000000000, 10.3200000000000,
				4.92000000000000, 7.07000000000000, 4.21000000000000, 4.62000000000000, 9.02000000000000,
				0.540000000000000, 6.14000000000000, 7.82000000000000, 19.7800000000000, 6.28000000000000,
				6.18000000000000, 2.66000000000000, 4.24000000000000, 10.6800000000000, 0.500000000000000,
				2.15000000000000, 12.2900000000000, 15.2200000000000, 7.04000000000000, 8.86000000000000,
				3.76000000000000, 1.91000000000000, 8.87000000000000, 0.830000000000000, 5.06000000000000,
				8.82000000000000, 10.8300000000000, 8.51000000000000, 9.65000000000000, 4.19000000000000, 2,
				9.72000000000000, 0.300000000000000, 5.93000000000000, 7.62000000000000, 14.6200000000000,
				6.07000000000000, 7.46000000000000, 3.38000000000000, 2.77000000000000, 10.5100000000000,
				0.440000000000000, 10.2800000000000, 9.64000000000000, 14.1800000000000, 6.21000000000000,
				6.99000000000000, 3.10000000000000, 3.11000000000000, 15.7300000000000, 0.950000000000000,
				5.84000000000000, 7.63000000000000, 11.9900000000000, 5.83000000000000, 8.46000000000000,
				3.43000000000000, 3.96000000000000, 10.3000000000000, 3, 5.34000000000000, 8.18000000000000,
				9.49000000000000, 7.51000000000000, 5.74000000000000, 3.88000000000000, 3.78000000000000,
				8.54000000000000, 0.920000000000000, 4.65000000000000, 5.90000000000000, 14.4500000000000,
				5.30000000000000, 8.06000000000000, 4.05000000000000, 4.16000000000000, 7.51000000000000,
				0.630000000000000, 3.04000000000000, 9.02000000000000, 13.4800000000000, 5.25000000000000,
				6.98000000000000, 4.14000000000000, 2.88000000000000, 7.23000000000000, 0.590000000000000,
				8.53000000000000, 7.33000000000000, 14.7500000000000, 5.41000000000000, 6.77000000000000,
				3.84000000000000, 3.35000000000000, 8.05000000000000, 0.540000000000000, 5.95000000000000,
				11.6600000000000, 15.0100000000000, 5.28000000000000, 6.92000000000000, 4.51000000000000,
				3.76000000000000, 7.86000000000000, 0.170000000000000, 13.2000000000000, 6.87000000000000,
				8.18000000000000, 4.48000000000000, 4.44000000000000, 4.71000000000000, 4.43000000000000,
				8.22000000000000, 0.410000000000000, 7.31000000000000, 11.6000000000000, 9.77000000000000,
				5.12000000000000, 7.09000000000000, 5.39000000000000, 3.38000000000000, 13.0600000000000,
				1.33000000000000, 4.43000000000000, 6.59000000000000, 11.6100000000000, 4.92000000000000,
				8.09000000000000, 6.20000000000000, 3.74000000000000, 11.2100000000000, 1.49000000000000,
				10.1000000000000, 6.72000000000000, 13.7600000000000, 5.24000000000000, 5.97000000000000,
				4.46000000000000, 4.65000000000000, 11.5600000000000, 1.78000000000000, 10.3900000000000,
				6.67000000000000, 10.0600000000000, 4.61000000000000, 7.73000000000000, 3.92000000000000,
				5.18000000000000, 13.1200000000000, 1.56000000000000, 11.8500000000000, 9.81000000000000,
				9.68000000000000, 4.64000000000000, 5.13000000000000, 4.52000000000000, 6.01000000000000,
				10.7400000000000, 2.69000000000000, 3.85000000000000, 9.06000000000000, 11.5700000000000,
				6.42000000000000, 5.61000000000000, 4.11000000000000, 9.12000000000000, 14.7000000000000,
				1.24000000000000, 4.71000000000000, 6.66000000000000, 12.4500000000000, 7.04000000000000,
				4.98000000000000, 3.32000000000000, 5.79000000000000, 10.8700000000000, 1.31000000000000,
				5.21000000000000, 10.0900000000000, 12.1100000000000, 5.94000000000000, 4.56000000000000,
				2.92000000000000, 4.31000000000000, 13.7600000000000, 1.61000000000000, 6.15000000000000,
				10.4800000000000, 11.6000000000000, 6.62000000000000, 9.38000000000000, 1.23000000000000,
				2.42000000000000, 13.0600000000000, 14.1600000000000, 7.67000000000000, 12.1200000000000,
				13.1700000000000, 10.9900000000000, 7.39000000000000, 1.13000000000000, 2.41000000000000,
				12.4500000000000, 2.80000000000000, 5.11000000000000, 9.91000000000000, 13.9100000000000,
				7.08000000000000, 8.65000000000000, 1.69000000000000, 3.10000000000000, 14.6200000000000,
				1.78000000000000, 7.39000000000000, 10.7000000000000, 13.4900000000000, 7.08000000000000,
				6.68000000000000, 1.24000000000000, 2.15000000000000, 15.3600000000000, 1.03000000000000,
				8.31000000000000, 11.3400000000000, 12.5900000000000, 8.35000000000000, 9.19000000000000,
				2.01000000000000, 2.34000000000000, 10.2000000000000, 1.14000000000000, 2.86000000000000,
				11.2500000000000, 12.1200000000000, 7.08000000000000, 8.23000000000000, 2.88000000000000,
				2.14000000000000, 9.11000000000000, 0.420000000000000, 8.12000000000000, 11.9600000000000,
				12.0400000000000, 6.40000000000000, 8.68000000000000, 2.36000000000000, 1.45000000000000,
				6.34000000000000, 2.28000000000000, 4.03000000000000, 8.56000000000000, 11.5600000000000,
				6.35000000000000, 7.67000000000000, 2.11000000000000, 1.26000000000000, 8.77000000000000,
				1.55000000000000, 5.17000000000000, 10.7900000000000, 15.4400000000000, 12.7300000000000,
				6.68000000000000, 1.65000000000000, 3.11000000000000, 5.49000000000000, 3.64000000000000,
				4.10000000000000, 14.2200000000000, 12.4000000000000, 11.1800000000000, 12.2100000000000,
				2.33000000000000, 1.87000000000000, 9.13000000000000, 0.870000000000000, 4.60000000000000,
				9.36000000000000, 13.3400000000000, 10.4900000000000, 12.3200000000000, 1.58000000000000,
				1.50000000000000, 7.99000000000000, 3.32000000000000, 4.29000000000000, 13.2100000000000,
				13.0900000000000, 7.64000000000000, 8.15000000000000, 3.02000000000000, 1.37000000000000,
				9.20000000000000, 5.15000000000000, 5.47000000000000, 10.0200000000000, 12.9100000000000,
				10.8200000000000, 7.64000000000000, 1.36000000000000, 2.43000000000000, 10.2400000000000,
				4.87000000000000, 8.54000000000000, 12.8300000000000, 12.2900000000000, 7.45000000000000,
				10.3900000000000, 2.80000000000000, 2.20000000000000, 6.76000000000000, 10.2900000000000,
				2.10000000000000, 11.6500000000000, 13.6000000000000, 6.48000000000000, 8.38000000000000,
				3.82000000000000, 2.83000000000000, 5.24000000000000, 13.5000000000000, 3.41000000000000,
				12.9700000000000, 11.2400000000000, 8.77000000000000, 6.96000000000000, 5.02000000000000,
				3.07000000000000, 3.65000000000000, 4.19000000000000, 3.14000000000000, 11.1000000000000,
				11.2100000000000, 5.45000000000000, 6.45000000000000, 3.14000000000000, 2.79000000000000,
				2.84000000000000, 3.21000000000000, 5.80000000000000, 7.63000000000000, 17.6100000000000,
				13.9000000000000, 6.83000000000000, 4.67000000000000, 4.41000000000000, 7.31000000000000,
				7.44000000000000, 8.61000000000000, 6.13000000000000, 11.3500000000000, 4.88000000000000,
				4.47000000000000, 5.20000000000000, 4.29000000000000, 5.97000000000000, 6.34000000000000,
				8.04000000000000, 11.6600000000000, 10.9600000000000, 3.94000000000000, 5.70000000000000,
				4.39000000000000, 5.09000000000000, 4.44000000000000, 6.34000000000000, 7.45000000000000,
				12.1000000000000, 12.6900000000000, 5.21000000000000, 8.67000000000000, 3.74000000000000,
				5.49000000000000, 4.07000000000000, 8.69000000000000, 9.50000000000000, 10.0200000000000,
				16.2200000000000, 7.96000000000000, 5.58000000000000, 2.42000000000000, 3.59000000000000,
				4.69000000000000, 8.33000000000000, 6.38000000000000, 6.56000000000000, 10.7100000000000,
				4.20000000000000, 3.75000000000000, 4.07000000000000, 5.56000000000000, 1.70000000000000,
				14.4600000000000, 6.98000000000000, 6.41000000000000, 10.0400000000000, 5.17000000000000,
				3.05000000000000, 3.97000000000000, 5.48000000000000, 2.28000000000000, 13.9400000000000,
				7.57000000000000, 11.7800000000000, 9.28000000000000, 5.57000000000000, 5.06000000000000,
				4.44000000000000, 4.42000000000000, 1.40000000000000, 9.13000000000000, 7.82000000000000,
				5.95000000000000, 11.0800000000000, 3.93000000000000, 7.89000000000000, 4.73000000000000,
				5.75000000000000, 0.600000000000000, 8.54000000000000, 8.41000000000000, 5.94000000000000,
				9.79000000000000, 4.19000000000000, 5.35000000000000, 5.32000000000000, 4.49000000000000,
				0.680000000000000, 7.44000000000000, 7.13000000000000, 6.35000000000000, 10.2100000000000,
				3.51000000000000, 5.34000000000000, 5.04000000000000, 3.12000000000000, 1.74000000000000,
				8.69000000000000, 11.4800000000000, 7.51000000000000, 9.63000000000000, 6.65000000000000,
				6.81000000000000, 4.09000000000000, 3.20000000000000, 2.85000000000000, 11.8200000000000,
				6.61000000000000, 12.4000000000000, 11.9300000000000, 4.93000000000000, 6.81000000000000,
				2.84000000000000, 2.98000000000000, 2.82000000000000, 12.2000000000000, 4.32000000000000,
				12.6100000000000, 10.6600000000000, 7.04000000000000, 8.92000000000000, 3.21000000000000,
				2.52000000000000, 3.14000000000000, 11.9600000000000, 13.9300000000000, 15.0500000000000,
				14.8700000000000, 12.6500000000000, 8.09000000000000, 1.55000000000000, 2.02000000000000,
				5.06000000000000, 14.0200000000000, 6.69000000000000, 12.7600000000000, 19.2000000000000,
				10.9100000000000, 9.37000000000000, 1.79000000000000, 3.04000000000000, 4.43000000000000,
				9.10000000000000, 5.80000000000000, 11.8000000000000, 14.8700000000000, 8.57000000000000,
				5.42000000000000, 1.01000000000000, 1.88000000000000, 7.65000000000000, 10.7300000000000,
				5.59000000000000, 12.6700000000000, 17.3200000000000, 13.7700000000000, 11.2500000000000,
				1.54000000000000, 2.93000000000000, 8.10000000000000, 11.0700000000000, 3.88000000000000,
				9.37000000000000, 12.8000000000000, 10.1300000000000, 6.84000000000000, 1.62000000000000,
				2.83000000000000, 6.39000000000000, 8.44000000000000, 7.41000000000000, 10.0200000000000,
				13.8100000000000, 11.3300000000000, 6.67000000000000, 1.86000000000000, 2.84000000000000,
				9.57000000000000, 7.46000000000000, 10.1400000000000, 7.81000000000000, 12.8200000000000,
				11.2000000000000, 9.60000000000000, 2.93000000000000, 2.55000000000000, 12.3500000000000,
				6.03000000000000, 3.38000000000000, 7.28000000000000, 12.7500000000000, 12.1900000000000,
				11.1900000000000, 3.05000000000000, 3.38000000000000, 5.67000000000000, 7.54000000000000,
				4.72000000000000, 9.22000000000000, 11.3300000000000, 5.62000000000000, 9.73000000000000,
				3.64000000000000, 4.02000000000000, 4.70000000000000, 6.41000000000000, 5.70000000000000,
				9.76000000000000, 18.8800000000000, 9.62000000000000, 6.72000000000000, 2.13000000000000,
				3.15000000000000, 7.40000000000000, 10.2900000000000, 11.6700000000000, 7.50000000000000,
				12.9100000000000, 14.7500000000000, 8.97000000000000, 1.23000000000000, 2.87000000000000,
				10.8200000000000, 7.73000000000000, 7.14000000000000, 12.4300000000000, 17.7000000000000,
				10.4600000000000, 14.0700000000000, 0.870000000000000, 3, 8.59000000000000, 11.1000000000000,
				4.43000000000000, 11.9200000000000, 13.1300000000000, 6.39000000000000, 6.82000000000000,
				1.66000000000000, 2.95000000000000, 5.96000000000000, 7.37000000000000, 4.33000000000000,
				6.91000000000000, 11.3300000000000, 5.02000000000000, 8.01000000000000, 3.74000000000000,
				2.34000000000000, 4.28000000000000, 0.900000000000000, 8.17000000000000, 7.93000000000000,
				14.0800000000000, 5.16000000000000, 5.66000000000000, 3.15000000000000, 4.23000000000000,
				10.0100000000000, 7.42000000000000 };

		ranges = splitArray(distanceRanges, 9);

		Point2d estimate;
		double[] temp;
		RealMatrix rm = new Array2DRowRealMatrix(ranges);
		for (int v = 0; v < ranges.length; v++) {
			temp = rm.getRow(v);

			estimate = latmath.algorithm.GeolaterationN.multilaterate(anchors, temp, doApprox, approxMethod, doFilter1,
					doFilter1IncludeApprox, filter1Limit, doFilter2, medianFactor, weightRealIntersection,
					weightApproxIntersection, CENTER_OF_MASS);

			// System.out.println(v + 1 + ")" + " Final estimated position: " + estimate);
			// System.out.println(estimate.x);
			 System.out.println(estimate.y);

			/*
			 * for (int i = 0; i < temp.length; i++) { System.out.print(" " + temp[i]); }
			 * System.out.println();
			 */

		}
	}

	public static double[][] splitArray(double[] arrayToSplit, int chunkSize) {

		if (chunkSize <= 0) {
			return null;
		}

		int rest = arrayToSplit.length % chunkSize;
		int chunks = arrayToSplit.length / chunkSize + (rest > 0 ? 1 : 0);
		double[][] arrays = new double[chunks][];

		for (int i = 0; i < (rest > 0 ? chunks - 1 : chunks); i++) {
			arrays[i] = Arrays.copyOfRange(arrayToSplit, i * chunkSize, i * chunkSize + chunkSize);
		}

		if (rest > 0) {
			arrays[chunks - 1] = Arrays.copyOfRange(arrayToSplit, (chunks - 1) * chunkSize,
					(chunks - 1) * chunkSize + rest);
		}
		return arrays;
	}
}